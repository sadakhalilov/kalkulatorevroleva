<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>–ï–≤—Ä–æ-–ö–∞—Å–∞ 2026</title>
<style>
/* –û–°–ù–û–í–ï–ù –°–¢–ò–õ */
:root{ --primary:#00264d; --accent:#d4af37; --bg:#f2f2f2; --error:#dc3545; --ok:#28a745; --eur:#28a745; --bgn:#007bff; --font-size:22px; }
*{box-sizing:border-box; touch-action: manipulation;}
body{margin:0;font-family: 'Segoe UI', Arial, sans-serif;background:var(--bg);display:flex;justify-content:center;padding:10px}
.container{background:#fff;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.2);width:100%;max-width:600px;padding:20px}
.logo-circle { width: 70px; height: 70px; background: var(--primary); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 45px; font-weight: bold; margin: 0 auto 15px; border: 3px solid var(--accent); }
h2{margin:0 0 20px;text-align:center;color:var(--primary);font-size:28px; font-weight: 800; border-bottom: 3px solid var(--accent); padding-bottom: 10px;}
label{font-weight:700;font-size:14px;display:block;margin-bottom:6px;text-transform: uppercase;}
input[type=number],input[type=text]{width:100%;font-size:var(--font-size);padding:15px;border:2px solid #ccc;border-radius:8px;text-align:right;margin-bottom:12px;font-weight:bold;}
.eur-input{border-color:var(--eur);background:#fafffb}
.bgn-input{border-color:var(--bgn);background:#f5faff}
.bgn-hint { font-size: 16px; font-weight: bold; color: var(--bgn); margin-top: -10px; margin-bottom: 15px; text-align: right; }
.result-zone{background:var(--primary);color:#fff;padding:20px;border-radius:12px;text-align:center;margin:15px 0; border: 2px solid var(--accent); transition: 0.3s;}
.result-value{font-size:44px;font-weight:bold;color:var(--accent);margin:5px 0}
.change-toggle{display:flex;justify-content:center;gap:8px;margin:12px 0}
.change-toggle button{flex:1;padding:10px;border:1px solid #fff;border-radius:6px;background:transparent;color:#fff;font-weight:600;cursor:pointer;font-size:12px}
.change-toggle button.active{background:#fff;color:var(--primary)}
.button-group{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:15px}
button.action-btn{padding:18px;border:none;border-radius:8px;font-size:18px;font-weight:700;cursor:pointer;color:#fff; display:flex; align-items:center; justify-content:center; gap:8px}
.btn-save{background:var(--ok)} 
.btn-save:disabled {background:#666; cursor:not-allowed; opacity:0.6;}
.btn-print{background:var(--primary)}
.btn-clear{background:var(--error); grid-column: span 2; margin-top: 5px; padding: 10px; font-size: 14px;}
.history-table-container { overflow-x: auto; margin-top: 20px; }
.history-table{width:100%;font-size:12px;border-collapse:collapse; min-width: 400px;}
.history-table th,.history-table td{border:1px solid #ddd;padding:10px;text-align:center}
.history-table th{background:var(--primary);color:#fff}
#adminPanel{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);color:#fff;padding:30px;z-index:100;}

/* –°–¢–ò–õ –ó–ê –ü–ï–ß–ê–¢ (20—Å–º —à–∏—Ä–∏–Ω–∞) */
@media print { 
    body * { visibility: hidden; } 
    #print-area, #print-area * { visibility: visible; } 
    #print-area { 
        position: absolute; 
        left: 0; 
        top: 0; 
        width: 195mm; 
        display: block !important; 
        padding: 5px; 
        font-size: 15px; 
        border: 1px solid #000;
        line-height: 1.4;
    } 
    .print-header { text-align: center; font-weight: bold; font-size: 18px; border-bottom: 1px solid #000; margin-bottom: 5px; text-transform: uppercase; }
    .print-row { display: flex; justify-content: space-between; margin-bottom: 2px; }
    @page { margin: 0.5cm; }
}
#print-area { display: none; }
</style>
</head>
<body>

<div class="container">
  <div class="logo-circle">‚Ç¨</div>
  <h2 id="storeTitle">–ö–ê–°–ê - 1</h2>

  <label style="color:var(--eur)">–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ (EUR)</label>
  <input id="totalEUR" type="number" inputmode="decimal" placeholder="0.00" class="eur-input" oninput="updateBgnHint()">
  <div id="bgnHint" class="bgn-hint">–†–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–æ—Å—Ç: 0.00 –ª–≤</div>

  <label style="color:var(--bgn)">–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–µ–≤–∞ (BGN)</label>
  <input id="givenBGN" type="number" inputmode="decimal" placeholder="0.00" class="bgn-input" oninput="calculate()">

  <label style="color:var(--eur)">–ü–ª–∞—Ç–µ–Ω–æ –≤ –µ–≤—Ä–æ (EUR)</label>
  <input id="givenEUR" type="number" inputmode="decimal" placeholder="0.00" class="eur-input" oninput="calculate()">

  <div class="result-zone" id="resZone">
    <div style="font-size:14px; font-weight:bold; letter-spacing:1px">–†–ï–°–¢–û –ó–ê –í–†–™–©–ê–ù–ï</div>
    <div id="restTotal" class="result-value">0.00 ‚Ç¨</div>
    <div class="change-toggle">
      <button id="btnGiveEUR" class="active" onclick="setGiveMode('EUR')">–í—Ä—ä—â–∞–º –≤ ‚Ç¨</button>
      <button id="btnGiveBGN" onclick="setGiveMode('BGN')">–í—Ä—ä—â–∞–º –≤ –ª–≤</button>
      <button id="btnGiveMix" onclick="setGiveMode('MIX')">–°–º–µ—Å–µ–Ω–æ</button>
    </div>
    <div id="restDetail" style="color:var(--accent); font-weight:bold; margin-bottom:10px;">(0.00 –ª–≤)</div>
  </div>

  <div class="button-group">
    <button id="btnSaveMain" class="action-btn btn-save" onclick="saveOrder()">üíæ –ó–∞–ø–∏—Å (Enter)</button>
    <button class="action-btn btn-print" onclick="printOrder()">üñ®Ô∏è –ü–µ—á–∞—Ç (P)</button>
    <button class="action-btn btn-clear" onclick="clearFields()">üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏ –ø–æ–ª–µ—Ç–∞—Ç–∞</button>
  </div>

  <div class="history-table-container">
    <table class="history-table">
      <thead><tr><th>–ß–∞—Å</th><th>–°–º–µ—Ç–∫–∞ ‚Ç¨</th><th>–ü–ª–∞—Ç–µ–Ω–æ</th><th>–†–µ—Å—Ç–æ</th></tr></thead>
      <tbody id="histBody"></tbody>
    </table>
  </div>
</div>

<div id="print-area"></div>

<button style="position:fixed;bottom:10px;right:10px;opacity:.5;font-size:24px;background:none;border:none;" onclick="toggleAdmin()">‚öôÔ∏è</button>
<div id="adminPanel">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ <button onclick="toggleAdmin()" style="float:right">‚úñ</button></h3>
    <input id="storeNameInput" type="text" placeholder="–ò–º–µ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω">
    <button onclick="saveSettings()" style="width:100%; padding:15px; background:var(--ok); color:#fff; border:none; border-radius:8px; font-weight:bold;">–ó–ê–ü–ê–ó–ò</button>
    <button onclick="clearHistory()" style="width:100%; padding:10px; background:var(--error); color:#fff; border:none; margin-top:20px;">–ò–∑—Ç—Ä–∏–π –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</button>
</div>

<script>
const RATE = 1.95583;
const INV_RATE = 0.511292;
let giveMode = 'EUR';
let isDeficit = false;

function printOrder() {
    const total = parseFloat(document.getElementById('totalEUR').value) || 0;
    if (total <= 0) return;
    const paidEUR = parseFloat(document.getElementById('givenEUR').value) || 0;
    const paidBGN = parseFloat(document.getElementById('givenBGN').value) || 0;
    const restStr = document.getElementById('restTotal').innerText;
    const restLeva = document.getElementById('restDetail').innerText;
    
    const now = new Date();
    const dateStr = now.toLocaleDateString('bg-BG') + ' –≥.';
    const timeStr = now.toLocaleTimeString('bg-BG');

    document.getElementById('print-area').innerHTML = `
        <div class="print-header">–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–ê –ë–ï–õ–ï–ñ–ö–ê</div>
        <div class="print-row">
            <span><strong>–î–ê–¢–ê:</strong> ${dateStr}</span>
            <span><strong>—á–∞—Å:</strong> ${timeStr}</span>
        </div>
        <div><strong>–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ –≤ –µ–≤—Ä–æ:</strong> ${total.toFixed(2)} –µ–≤—Ä–æ</div>
        <div><strong>–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–µ–≤–∞:</strong> ${paidBGN.toFixed(2)} —Ä–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–∞ ${(paidBGN * INV_RATE).toFixed(2)} –µ–≤—Ä–æ</div>
        <div><strong>–†–µ—Å—Ç–æ –≤—ä—Ä–Ω–∞—Ç–æ –≤ –µ–≤—Ä–æ:</strong> ${restStr} —Ä–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–∞ ${restLeva}</div>
        <div style="margin-top:10px; font-weight:bold;">
            –ö—É—Ä—Å –Ω–∞ –ë–ù–ë: 1 EUR = 1.95583 BGN<br>
            –û–±—Ä–∞—Ç–µ–Ω –∫—É—Ä—Å –Ω–∞ –ë–ù–ë: 1 BGN = 0.511292 EUR
        </div>
    `;
    window.print();
}

document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') { e.preventDefault(); saveOrder(); } 
    else if (e.key.toLowerCase() === 'p' || e.key.toLowerCase() === '–∑') { printOrder(); }
});

function updateBgnHint() {
    const eur = parseFloat(document.getElementById('totalEUR').value) || 0;
    document.getElementById('bgnHint').innerText = `–†–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–æ—Å—Ç: ${(eur * RATE).toFixed(2)} –ª–≤`;
    calculate();
}

function setGiveMode(m) {
    giveMode = m;
    ['EUR','BGN','MIX'].forEach(x => document.getElementById('btnGive'+x).classList.toggle('active', m===x));
    calculate();
}

function calculate() {
    const totalEUR = parseFloat(document.getElementById('totalEUR').value) || 0;
    const paidEUR = parseFloat(document.getElementById('givenEUR').value) || 0;
    const paidBGN = parseFloat(document.getElementById('givenBGN').value) || 0;
    const totalPaidInEUR = paidEUR + (paidBGN / RATE);
    const restEUR = totalPaidInEUR - totalEUR;
    
    const resEl = document.getElementById('restTotal');
    const detEl = document.getElementById('restDetail');
    const resZone = document.getElementById('resZone');
    const saveBtn = document.getElementById('btnSaveMain');
    
    if (restEUR < -0.001 && totalEUR > 0) {
        isDeficit = true;
        resEl.innerText = "–ù–ï–î–û–°–¢–ò–ì";
        detEl.innerText = (Math.abs(restEUR) * RATE).toFixed(2) + " –ª–≤";
        resZone.style.boxShadow = "0 0 20px #dc3545";
        saveBtn.disabled = true;
        return;
    }

    isDeficit = false;
    saveBtn.disabled = false;
    resZone.style.boxShadow = "0 0 0px transparent";
    
    let displayRest = "0.00 ‚Ç¨";
    let subDetail = "(0.00 –ª–≤)";

    if (totalEUR > 0) {
        if(giveMode === 'EUR') {
            displayRest = restEUR.toFixed(2) + " ‚Ç¨";
            subDetail = "(" + (restEUR * RATE).toFixed(2) + " –ª–≤)";
        } else if(giveMode === 'BGN') {
            displayRest = (restEUR * RATE).toFixed(2) + " –ª–≤";
            subDetail = "(" + restEUR.toFixed(2) + " ‚Ç¨)";
        } else {
            const wholeEUR = Math.floor(restEUR + 0.0001);
            const centsEUR = restEUR - wholeEUR;
            displayRest = wholeEUR + " ‚Ç¨";
            subDetail = "+ " + (centsEUR * RATE).toFixed(2) + " –ª–≤";
        }
    }
    resEl.innerText = displayRest;
    detEl.innerText = subDetail;
}

function saveOrder() {
    if (isDeficit) return;
    const totalVal = parseFloat(document.getElementById('totalEUR').value);
    if (!totalVal || totalVal <= 0) return;
    const order = {
        time: new Date().toLocaleTimeString('bg-BG'),
        total: document.getElementById('totalEUR').value + " ‚Ç¨",
        paid: `‚Ç¨:${document.getElementById('givenEUR').value || 0} / –ª–≤:${document.getElementById('givenBGN').value || 0}`,
        rest: document.getElementById('restTotal').innerText
    };
    let history = JSON.parse(localStorage.getItem('euroKasa_history') || '[]');
    history.unshift(order);
    localStorage.setItem('euroKasa_history', JSON.stringify(history.slice(0, 50)));
    loadHistory();
    clearFields();
}

function loadHistory() {
    const history = JSON.parse(localStorage.getItem('euroKasa_history') || '[]');
    const body = document.getElementById('histBody');
    body.innerHTML = history.map(h => `<tr><td>${h.time}</td><td>${h.total}</td><td>${h.paid}</td><td>${h.rest}</td></tr>`).join('');
}

function clearFields() {
    document.getElementById('totalEUR').value = '';
    document.getElementById('givenBGN').value = '';
    document.getElementById('givenEUR').value = '';
    updateBgnHint();
}

function toggleAdmin() {
    const p = document.getElementById('adminPanel');
    p.style.display = p.style.display === 'block' ? 'none' : 'block';
}

function saveSettings() {
    const newName = document.getElementById('storeNameInput').value;
    localStorage.setItem('euroKasa_storeName', newName);
    document.getElementById('storeTitle').innerText = newName;
    toggleAdmin();
}

function clearHistory() {
    if(confirm('–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞?')) { 
        localStorage.removeItem('euroKasa_history'); 
        loadHistory(); 
    }
}

window.onload = () => {
    const savedName = localStorage.getItem('euroKasa_storeName');
    if(savedName) document.getElementById('storeTitle').innerText = savedName; 
    loadHistory();
};
</script>
</body>
</html>
